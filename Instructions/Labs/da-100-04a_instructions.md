

### ラボ 04A

Power BI Desktop でのデータ モデリング

# 概要

**ラボを完了するための所要時間は 45 分です**

このラボでは、データ モデルの開発を開始します。テーブル間のリレーションシップを作成し、テーブルと列のプロパティを構成して、データ モデルの親しみやすさと使いやすさを向上させます。また、階層を作成し、クイック メジャーを作成します。

このラボでは、次の方法を学習します。

* モデルの関係を作成する

* テーブルと列のプロパティを構成する

* 階層を作成する

* クイック メジャーを作成する

# 演習 1: モデルの関係を作成する

この演習では、モデルの関係を作成します。

前のラボを正常に完了した自信がない場合は、**D:\DA100\Lab03A\Solution** フォルダーにある前のラボのソリューション ファイルを開くことができます。

### タスク 1: モデルの関係を作成する

このタスクでは、モデルのリレーションシップを作成します。

1. Power BI Desktop の左側で、「**モデル**」 ビュー アイコンをクリックします。

	![画像 1](Linked_image_Files/PowerBI_Lab04A_image1.png)

2. 7 つのテーブルがすべて表示されない場合は、左右に右にスクロールし、テーブルをまとめてドラッグして整列して、すべてのテーブルを同時に表示できるようにします。

	*モデル ビューでは、各テーブルと関係 (テーブル間のコネクタ) を表示できます。現在、**Lab 02A** でデータロード関係オプションを無効にしたため、関係はありません*。

3. 「レポート」 ビューに戻るには、左側の 「**レポート**」 ビュー アイコンをクリックします。

	![画像 327](Linked_image_Files/PowerBI_Lab04A_image2.png)

4. すべてのテーブル フィールドを表示するには、「**フィールド**」 ペインで空の領域を右クリックし、「**すべて展開**」 を選択します。

	![画像 328](Linked_image_Files/PowerBI_Lab04A_image3.png)

5. テーブルのビジュアルを作成するには、「**フィールド**」 ペインの 「**Product**」 テーブル内から、「**Category**」 フィールドを確認します。

	![画像 329](Linked_image_Files/PowerBI_Lab04A_image4.png)

	*これ以降、ラボではフィールドの参照に省略表記を使用します。次のようになります。**製品 | カテゴリー***。

6. テーブルに列を追加するには、「**フィールド**」 ペインで、「**売上高**」 を確認します** | **「**販売**」 フィールド。

7. 表のビジュアルには 4 つの製品カテゴリがリストされており、売上値はそれぞれ同じで、合計も同じであることに注意してください。

	![画像 330](Linked_image_Files/PowerBI_Lab04A_image5.png)

	*問題は、テーブルが異なるテーブルのフィールドに基づいていることです。各製品カテゴリには、そのカテゴリの売上が表示されることが期待されています。ただし、これらのテーブル間にはモデルの関係がないため、**Sales **テーブルはフィルタリングされません。ここで、テーブル間でフィルターを伝播するための関係を追加します*。

8. 「**モデリング**」 リボン タブの 「**リレーションシップ**」 グループ内から、「** リレーションシップの管理**」 をクリックします。

	![画像 331](Linked_image_Files/PowerBI_Lab04A_image6.png)

9. 「**関係の管理**」 ウィンドウで、まだ関係が定義されていないことに注意してください。

10. リレーションシップを作成するには、「**新規作成**」 をクリックします。

	![画像 332](Linked_image_Files/PowerBI_Lab04A_image7.png)

11. 「**リレーションシップの作成**」 ウィンドウの最初のドロップダウン リストで、「**商品**」 テーブルを選択します。

	![画像 333](Linked_image_Files/PowerBI_Lab04A_image8.png)

12. 2 番目のドロップダウン リスト（**Product** テーブル グリッドの下）で、**Sales** テーブルを選択します。

	![画像 334](Linked_image_Files/PowerBI_Lab04A_image9.png)

13. 各テーブルの 「**ProductKey**」 列が選択されていることに注意してください。

	*列は同じ名前を共有しているため、自動的に選択されました*。

14. 「**カーディナリティ**」 ドロップダウン リストで、「**1 対多**」 が選択されていることに注意してください。

	* Power BIは **Product** テーブルの **ProductKey** 列に一意の値が含まれていると認識しているため、カーディナリティは自動的に検出されました。1 対多の関係は最も一般的なカーディナリティであり、このラボで作成するすべての関係はこのタイプになります。**Lab 05A*** で多対多のカーディナリティを使用します。

15. 「**クロス フィルターの方向**」 ドロップダウン リストで、「**単一**」 が選択されていることを確認します。  

	*単一フィルター方向とは、フィルターが「片側」から「多辺」に伝播することを意味します。この場合、**Product** テーブルに適用されたフィルターは **Sales** テーブルに伝播しますが、他の方向には伝播しません。**Lab 05A*** で双方向関係を使用します。

16. 「**このリレーションシップをアクティブにする**」 がオンになっていることを確認します。 

	*アクティブな関係はフィルタを伝達します。関係を非アクティブとしてマークして、フィルターが伝搬しないようにすることができます。テーブル間に複数のリレーションシップパスがある場合、非アクティブなリレーションシップが存在する可能性があります。その場合、モデル計算は特別な関数を使用してアクティブ化できます。**Lab 05A*** で非アクティブな関係で作業します。

17. 「**OK**」 をクリックします。

	![画像 335](Linked_image_Files/PowerBI_Lab04A_image10.png)

18. 「**リレーションシップの管理**」 ウィンドウで、新しいリレーションシップが表示されていることを確認し、「**閉じる**」 をクリックします。   

	![画像 336](Linked_image_Files/PowerBI_Lab04A_image11.png)

19. レポートでは、テーブル ビジュアルが更新され、製品カテゴリごとに異なる値が表示されていることを確認します。

	![画像 337](Linked_image_Files/PowerBI_Lab04A_image12.png)

20. 「**Product**」 テーブルに適用されたフィルターは、「**Sales**」 テーブルに伝達されるようになりました。

21. モデル ビューに切り替えると、2 つのテーブル間にコネクタが存在することに気付きます。

	![画像 338](Linked_image_Files/PowerBI_Lab04A_image13.png)

22. この図では、**1** および*****インジケーターで表されるカーディナリティーを解釈できることに注意してください。

	*フィルターの方向は矢印の頭で表されます。実線はアクティブな関係を表します。破線は非アクティブな関係を表します*。

23. 関係にカーソルを合わせると、関連する列が表示されます。

	*関係を作成する簡単な方法があります。モデル ダイアグラムでは、列をドラッグ アンド ドロップして新しい関係を作成できます*。

24. 新しいリレーションシップを作成するには、「**Reseller**」 テーブルから、「**ResellerKey** 列を 「**Sales**」 テーブルの 「**ResellerKey**」 列にドラッグします。

	![画像 339](Linked_image_Files/PowerBI_Lab04A_image14.png)

	*ヒント: 列をドラッグしたくない場合があります。この状況が発生した場合は、別の列を選択してから、もう一度ドラッグする列を選択して、再試行してください*。

25. 次の 2 つのモデル関係を作成します。

	* **リージョン | SalesTerritoryKey** から **Sales | 営業地域キー**

	* **営業担当者 | EmployeeKey** から **Sales | 従業員キー**

	*このラボでは、**SalespersonRegion** および **Targets** テーブルは切断されたままです。営業担当者と地域の間には多対多の関係があります。この高度なシナリオは次のラボで行います*。

26. ダイアグラムで、**Sales** テーブルを中央に配置し、関連するテーブルを配置します。 

	![画像 340](Linked_image_Files/PowerBI_Lab04A_image15.png)

27. Power BI Desktop ファイルを保存します。

# 演習 2: テーブルの構成

この演習では、階層を作成し、列を非表示、フォーマット、および分類して、各テーブルを構成します。

### タスク 1: 製品テーブルを構成する

このタスクでは、**Product** テーブルを構成します。

1. モデル ビューの 「**フィールド**」 ウィンドウで、必要に応じて 「**製品**」 テーブルを展開します。   

29. 階層を作成するには、「**フィールド**」 ウィンドウで 「**カテゴリ**」 列を右クリックし、「**階層の作成**」 を選択 します。

	![画像 341](Linked_image_Files/PowerBI_Lab04A_image16.png)

30. 「**プロパティ**」 ウィンドウ (「**フィールド**」 ペインの左側) の 「**名前**」 ボックスで 、テキストを **Products** に置き換えます。       

	![画像 344](Linked_image_Files/PowerBI_Lab04A_image17.png)

31. 階層に 2 番目のレベルを追加するには、「**階層**」 ドロップダウン リストで 「**サブカテゴリ**」 を選択します。   

32. 3 番目のレベルを階層に追加するには、「**階層**」 ドロップダウン リストで、「**製品**」 を選択します。

33. 階層の設計を完了するには、「**レベル変更の適用**」 をクリックします。

	![画像 343](Linked_image_Files/PowerBI_Lab04A_image18.png)

	*ヒント: 「**レベルの変更を適用**」 をクリックすることを忘れないでください。この手順を見落とすことはよくある間違いです。*

34. 「**フィールド**」 ペインで、「**製品**」 階層に注目してください。

	![画像 347](Linked_image_Files/PowerBI_Lab04A_image19.png)

35. 階層レベルを表示するには、**Products**階層を展開します。

	![画像 346](Linked_image_Files/PowerBI_Lab04A_image20.png)

36. 列を表示フォルダーに編成するには、**フィールド** ペインで、まず**背景色のフォーマット**列を選択します。

37. **Ctrl** キーを押しながら、「**フォントの色の形式**」 を選択します。

38. 「**プロパティ**」 ペインの 「**表示フォルダ**」 ボックスに、「**書式設定**」と入力します。

	![画像 348](Linked_image_Files/PowerBI_Lab04A_image21.png)

39. **フィールド** ペインで、2 つの列がフォルダー内にあることに注意してください。

	![画像 349](Linked_image_Files/PowerBI_Lab04A_image22.png)

	*表示フォルダーは、テーブル、特に多くのフィールドを含むテーブルを整理するのに優れた方法です*。

### タスク 2: 地域テーブルの設定

このタスクでは、**地域**テーブルを構成します。

1. **地域**テーブルで、次の 3 つのレベルを持つ **Regions** という名前の階層を作成します。

	* グループ

	* 国

	* リージョン

	![画像 350](Linked_image_Files/PowerBI_Lab04A_image23.png)

41. **国**レベルではなく、**国**列を選択します。

42. 「**プロパティ**」 ペインで 「**詳細**」 セクションを展開し、「**データ カテゴリ**」 ドロップダウン リストから 「**国/地域**」 を選択します。

	![画像 352](Linked_image_Files/PowerBI_Lab04A_image24.png)

	*データの分類は、レポート デザイナーにヒントを提供できます。この場合、列を国または地域として分類すると、マップの視覚化をレンダリングするときに、より正確な情報が提供されます*。

### タスク 3: リセラー テーブルを構成する

このタスクでは、**リセラー** テーブルを構成します。

1. **リセラー** テーブルで、次の 2 つのレベルを持つ **Resellers** という名前の階層を作成します。

	* ビジネス タイプ

	* リセラー

	![画像 351](Linked_image_Files/PowerBI_Lab04A_image25.png)

44. **geography** という名前の 2 番目の階層を作成します。次の 4 つのレベルがあります。

	* 国-地域

	* 都道府県

	* 市区町村

	* リセラー

	![画像 353](Linked_image_Files/PowerBI_Lab04A_image26.png)

45. 次の 3 つの列を分類します。

	* **Country-Region** (**Country/Region**)

	* **State-Province** (**State or Province**)

	* **City** は **City** とし

### タスク 4: 売上テーブルの構成

このタスクでは、**Sales** テーブルを構成します。

1. **Sales** テーブルで、**Cost** 列を選択します

47. 「**プロパティ**」 ペインの 「**説明**」 ボックスに、次のように入力します。**標準原価に基づく**

	![画像 358](Linked_image_Files/PowerBI_Lab04A_image27.png)

	*説明は、テーブル、列、階層、またはメジャーに適用できます。**フィールド** ペインでは、レポートの作成者がカーソルをフィールドの上に置くと、ツールチップに説明テキストが表示されます*。

48. **数量**列を選択します。

49. **Properties** ペインの **書式設定** セクション内から、**Thousands Separator** プロパティを **On** にスライドします。

	![画像 357](Linked_image_Files/PowerBI_Lab04A_image28.png)

50. 「**単価**」 列を選択します。 

51. 「**プロパティ**」 ペインの 「**書式設定**」 セクション内で、「**小数点以下桁数**」 プロパティを **2** にスライドします。

52. 「**詳細**」 グループ (下にスクロールして配置する必要がある場合があります) の 「**集計の方法**」 ドロップダウン リストで、「**平均**」 を選択します。

	![画像 354](Linked_image_Files/PowerBI_Lab04A_image29.png)

	*既定では、数値列は値を合計して集計されます。このデフォルトの動作は、レートを表す**単価 **のような列には適していません。デフォルトの要約を平均に設定すると、有用で正確な結果が得られます*。

### タスク 5: プロパティの一括更新

このタスクでは、1 回の一括更新で複数の列を更新します。このアプローチを使用して、列を非表示にし、列の値をフォーマットします。

1. 「**Ctrl**」 キーを押しながら、次の 13 列 (複数のテーブルにまたがる) を選択します。

	* 商品 | ProductKey

	* リージョン | 営業地域キー

	* リセラー | ResellerKey

	* 売上 | 従業員キー

	* 売上 | ResellerKey

	* 売上 | SalesOrderNumber

	* 売上 | 営業地域キー

	* 営業担当者 | EmployeeID

	* 営業担当者 | 従業員キー

	* 営業担当者 | UPN

	* SalespersonRegion | 従業員キー

	* SalespersonRegion | 営業地域キー

	* ターゲット | EmployeeID

54. 「**プロパティ**」 ペインで、「**非表示**」 プロパティを 「**オン**」 にスライドします。

	![画像 355](Linked_image_Files/PowerBI_Lab04A_image30.png)

	*列はリレーションシップによって使用されるか、行レベルのセキュリティ構成または計算ロジックで使用されるため、非表示に設定されました*。

	* **UPN** 列を使用して、次のラボで行レベルのセキュリティを定義します。**Lab 06A*** での計算には **SalesOrderNumber** を使用します。

55. 次の列を複数選択します。

	* 商品 | 標準のコスト

	* 売上 | 原価

	* 売上 | 売上

56. 「**Properties**」 ペインの 「**書式設定**」 セクション内から、「**Decimal Places**」 プロパティを **0** (ゼロ) に設定します。

	![画像 356](Linked_image_Files/PowerBI_Lab04A_image31.png)

# 演習 3: モデル インターフェイスの確認

この演習では、レポート ビューに切り替えて、モデルのインターフェイスを確認します。

### タスク 1: モデル インターフェイスの確認

このタスクでは、レポート ビューに切り替えて、モデル インターフェイスを確認します。

1. レポートビューに切り替えます。

58. 「**フィールド**」 ペインで、次のことに注意してください。

	* 列、階層、およびそれらのレベルはフィールドであり、レポートのビジュアルを構成するために使用できます

	* レポートの作成に関連するフィールドのみが表示されます

	* **SalespersonRegion** テーブルは表示されません。そのフィールドがすべて非表示になっているためです

	* **Region** および **リセラー** テーブルの空間フィールドは、空間アイコンで装飾されています

	* シグマ記号 (Ʃ)で飾られたフィールドは、既定で要約されます

	* カーソルを **Sales** の上に置くと、ツールチップが表示されます** | コスト** フィールド

59. 「**Sales | OrderDate**」 フィールドを展開すると、日付の階層が表示されます。

	![画像 359](Linked_image_Files/PowerBI_Lab04A_image32.png)

	*「**Targets | TargetMonth**」 は同じ階層を示します。これらの階層は、ユーザーが作成したものではありません。これらは自動的に作成されます。しかし、問題があります。Adventure Works の会計年度は、毎年 7 月 1 日に始まります。しかし、日付階層の年は毎年 1 月 1 日に始まります*。

	*この自動動作をオフにします。**Lab 06A** では、DAX を使用して日付テーブルを作成し、Adventure Works のカレンダーを定義するように構成します*。

60. 自動時刻/日付時刻をオフにするには、「**ファイル**」 リボン タブをクリックして、Backstage ビューを開きます。

61. 左側の 「**オプションと設定**」 を選択し、「**オプション**」 を選択します。

	![画像 360](Linked_image_Files/PowerBI_Lab04A_image33.png)

62. 左側にある 「**オプション**」 ウィンドウの 「**現在のファイル**」 グループで、「**データロード**」 を選択します。

	![画像 361](Linked_image_Files/PowerBI_Lab04A_image34.png)

63. 「**タイム インテリジェンス**」 セクションで、「**自動の日付/時刻**」 のチェックを外します。

	![画像 362](Linked_image_Files/PowerBI_Lab04A_image35.png)

64. 「**OK**」 をクリックします。

	![画像 9](Linked_image_Files/PowerBI_Lab04A_image36.png)

65. 「**フィールド**」 ペインで、日付階層が使用できなくなっていることに注意してください。

	![画像 363](Linked_image_Files/PowerBI_Lab04A_image37.png)

# 演習 4: クイック メジャーの作成

この演習では、2 つのクイック メジャーを作成します。

### タスク 1: クイック メジャーを作成する

このタスクでは、利益と利益率を計算する 2 つのクイック メジャーを作成します。

1. 「**フィールド**」 ペインで、「**売上**」 テーブルを右クリックし、「**新しいクイック メジャー**」 を選択します。

	![画像 366](Linked_image_Files/PowerBI_Lab04A_image38.png)

67. 「**クイック メジャー**」 ウィンドウの 「**計算**」 ドロップダウン リストで、「**数値演算**」 グループ内から 「**減算**」 を選択します。

	![画像 367](Linked_image_Files/PowerBI_Lab04A_image39.png)

68. 「**フィールド**」 ペインで、「**営業**」 テーブルを展開します。

69. 「**売上**」 フィールドを 「**基準値**」 ボックスにドラッグします。   

70. 「**コスト**」 フィールドを 「**減算する値**」 ボックスにドラッグします。   

	![画像 368](Linked_image_Files/PowerBI_Lab04A_image40.png)

71. 「**OK**」 をクリックします。

	![画像 369](Linked_image_Files/PowerBI_Lab04A_image41.png)

	*クイック メジャーが計算を作成します。シンプルで一般的な計算を簡単かつ迅速に作成できます。**Lab 06A*** の数式言語を使用して、このツールなしでメジャーを作成します。

72. 「**フィールド**」 ウィンドウの  「**営業**」 テーブル内で、新しいメジャーに注目します。   

	![画像 370](Linked_image_Files/PowerBI_Lab04A_image42.png)

	*メジャーは電卓アイコンで飾られています*。

73. メジャーの名前を変更するには、メジャーを右クリックして、「**名前の変更**」 を選択します。

	![画像 371](Linked_image_Files/PowerBI_Lab04A_image43.png)

	*ヒント: フィールドの名前を変更するには、フィールドをダブルクリックするか、フィールドを選択して**F2** を押すこともできます*。

74. メジャーの名前を **Profit** に変更し、**Enter** キーを押します。

75. 「**Sales**」 テーブルで、次の要件に基づいて 2 番目のクイック メジャーを追加します。 

	* **除算**算術演算を使用する

	* 「**売上高**」 を  「**売上高**」 に設定する** | 利益** フィールド

	* **分母**を**売上高**に設定します** | 販売**フィールド

	* メジャーの名前を **利益率**として変更する

	![画像 372](Linked_image_Files/PowerBI_Lab04A_image44.png)

	![画像 373](Linked_image_Files/PowerBI_Lab04A_image45.png)

76. **Profit Margin** メジャーが選択されていることを確認してから、**Measure Tools** コンテキスト リボンで、フォーマットを小数点以下 2 桁の **Percentage** に設定します。  

	![画像 374](Linked_image_Files/PowerBI_Lab04A_image46.png)

77. 2つのメジャーをテストするには、まずレポートページでテーブル ビジュアルを選択します。

78. 「**フィールド**」 ウィンドウで、2 つのメジャーを確認します。 

	![画像 375](Linked_image_Files/PowerBI_Lab04A_image47.png)

79. 右のガイドをクリックしてドラッグすると、テーブルのビジュアルが広がります。

	![画像 376](Linked_image_Files/PowerBI_Lab04A_image48.png)

80. メジャーが適切にフォーマットされた適切な結果を生成することを確認します。

	![画像 378](Linked_image_Files/PowerBI_Lab04A_image49.png)

### 仕上げ

このタスクでは、ラボを完了します。

1. テーブルを削除するには、テーブルをクリックして (それをクリックして)、**Delete** キーを押します。

82. Power BI Desktop ファイルを保存します。

	*次のラボでは、多対多の関係と行レベルのセキュリティを構成することにより、データ モデルを拡張します*。
